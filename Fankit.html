<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fankit</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: #ffffff;
            color: #333;
            line-height: 1.4;
        }
        
        /* –•–µ–¥–µ—Ä */
        .header {
            padding: 15px 20px;
            border-bottom: 1px solid #eaeaea;
            display: flex;
            align-items: center;
            gap: 15px;
            background: white;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: contain;
        }
        
        .title {
            font-size: 24px;
            font-weight: 600;
            color: #222;
        }
        
        /* –ü–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .nav-panel {
            padding: 15px 20px;
            background: #f8f8f8;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .back-button {
            color: #0066cc;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            display: none; /* –°–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }
        
        .back-button:hover {
            text-decoration: underline;
        }
        
        /* –ü–æ–∏—Å–∫ */
        .search-container {
            padding: 20px;
            background: #f8f8f8;
            border-bottom: 1px solid #e8e8e8;
        }
        
        .search-box {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 20px 12px 48px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: white;
            transition: all 0.2s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* –§–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏ –≤–º–µ—Å—Ç–µ */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .item:hover {
            border-color: #ccc;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .folder .item-preview {
            background: #f0f7ff;
        }
        
        .item-preview {
            width: 100%;
            height: 140px;
            background: #f8f8f8;
            overflow: hidden;
            position: relative;
        }
        
        .item-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .item:hover .item-preview img {
            transform: scale(1.03);
        }
        
        .folder-icon {
            width: 100%;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 52px;
            color: #0066cc;
        }
        
        .file-icon {
            width: 100%;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: #666;
            background: #f8f8f8;
        }
        
        .item-info {
            padding: 12px 15px;
            border-top: 1px solid #f0f0f0;
        }
        
        .item-name {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .folder .item-name {
            color: #0066cc;
        }
        
        .item-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .item-size {
            font-size: 12px;
            color: #666;
        }
        
        .item-type {
            font-size: 12px;
            color: #999;
        }
        
        /* –°–æ—Å—Ç–æ—è–Ω–∏—è */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            grid-column: 1 / -1;
        }
        
        .empty {
            text-align: center;
            padding: 40px;
            color: #999;
            grid-column: 1 / -1;
        }
        
        /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ */
        .search-results-title {
            font-size: 18px;
            font-weight: 500;
            margin: 0 0 20px;
            color: #333;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 12px;
            }
            
            .item-preview,
            .folder-icon,
            .file-icon {
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <!-- –•–µ–¥–µ—Ä -->
    <div class="header">
        <img src="https://raw.githubusercontent.com/bahrstars/bahrstars.github.io/refs/heads/main/GameFiles/Web/GameLogo.png" 
             alt="Logo" 
             class="avatar">
        <div class="title">Fankit</div>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <div class="nav-panel">
        <button class="back-button" id="back-button" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
    </div>
    
    <!-- –ü–æ–∏—Å–∫ -->
    <div class="search-container">
        <div class="search-box">
            <div class="search-icon">üîç</div>
            <input type="text" 
                   class="search-input" 
                   placeholder="–ü–æ–∏—Å–∫..."
                   id="search-input">
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container">
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div id="main-content">
            <div id="content" class="content-grid">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
        
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
        <div id="search-results" style="display: none;">
            <div class="search-results-title" id="search-results-title"></div>
            <div class="content-grid" id="search-results-grid"></div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const REPO_OWNER = 'bahrstars';
        const REPO_NAME = 'bahrstars.github.io';
        const START_PATH = 'GameFiles/Images'; // –¢–æ–ª—å–∫–æ –ø–∞–ø–∫–∞ Images
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let allFilesCache = [];
        let currentFolderFiles = [];
        let currentPath = '';
        let isDownloading = false; // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        document.addEventListener('DOMContentLoaded', async () => {
            await loadAllFilesForSearch();
            loadFolderContents('');
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ (—Ç–æ–ª—å–∫–æ Images –∏ –µ—ë –ø–æ–¥–ø–∞–ø–∫–∏)
        async function loadAllFilesForSearch() {
            try {
                const contents = await getGitHubContentsRecursive(START_PATH);
                allFilesCache = contents;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–∞–ø–∫–∏
        async function loadFolderContents(path) {
            currentPath = path;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥
            updateBackButton();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('content').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            document.getElementById('search-results').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            
            try {
                const fullPath = path ? `${START_PATH}/${path}` : START_PATH;
                const contents = await getGitHubContents(fullPath);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ —Ñ–∞–π–ª—ã
                currentFolderFiles = contents;
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º
                displayContents(contents);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                document.getElementById('content').innerHTML = '<div class="empty">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ</div>';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
        function updateBackButton() {
            const backButton = document.getElementById('back-button');
            
            if (currentPath === '') {
                backButton.style.display = 'none'; // –í –∫–æ—Ä–Ω–µ Images - —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            } else {
                backButton.style.display = 'block'; // –í –ø–æ–¥–ø–∞–ø–∫–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            }
        }
        
        // –í–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥
        function goBack() {
            if (currentPath === '') return; // –£–∂–µ –≤ –∫–æ—Ä–Ω–µ Images
            
            // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –ø–∞–ø–∫—É
            const pathParts = currentPath.split('/');
            pathParts.pop(); // –£–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —á–∞—Å—Ç—å –ø—É—Ç–∏
            
            const parentPath = pathParts.join('/');
            loadFolderContents(parentPath);
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–∞–ø–∫–∏
        async function getGitHubContents(path) {
            const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${path}`;
            
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            const data = await response.json();
            
            // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
            const seen = new Set();
            return data.filter(item => {
                const key = item.path + item.type;
                if (seen.has(key)) return false;
                seen.add(key);
                return true;
            });
        }
        
        // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞
        async function getGitHubContentsRecursive(path) {
            const contents = await getGitHubContents(path);
            const result = [];
            
            for (const item of contents) {
                if (item.type === 'dir') {
                    // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–æ–∫
                    const subContents = await getGitHubContentsRecursive(item.path);
                    result.push(...subContents);
                } else {
                    result.push(item);
                }
            }
            
            return result;
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
        function displayContents(contents) {
            const container = document.getElementById('content');
            
            if (contents.length === 0) {
                container.innerHTML = '<div class="empty">–ü–∞–ø–∫–∞ –ø—É—Å—Ç–∞</div>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –ø–∞–ø–∫–∏, –ø–æ—Ç–æ–º —Ñ–∞–π–ª—ã
            const sorted = [...contents].sort((a, b) => {
                if (a.type === b.type) return a.name.localeCompare(b.name);
                return a.type === 'dir' ? -1 : 1;
            });
            
            container.innerHTML = sorted.map(item => createItemElement(item)).join('');
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–û: —É–±—Ä–∞–Ω—ã –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã)
        function createItemElement(item) {
            const isFolder = item.type === 'dir';
            const isImage = !isFolder && isImageFile(item.name);
            
            if (isFolder) {
                // –ü–∞–ø–∫–∞
                return `
                    <div class="item folder" onclick="openFolder('${item.name.replace(/'/g, "\\'")}')">
                        <div class="folder-icon">üìÅ</div>
                        <div class="item-info">
                            <div class="item-name" title="${item.name.replace(/"/g, '&quot;')}">${item.name}</div>
                            <div class="item-details">
                                <div class="item-type">–ü–∞–ø–∫–∞</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // –§–∞–π–ª
                const rawUrl = item.download_url || 
                              `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${item.path}`;
                
                if (isImage) {
                    // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π HTML –±–µ–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
                    const safeName = item.name.replace(/"/g, '&quot;').replace(/'/g, '&#039;');
                    const safeUrl = rawUrl.replace(/"/g, '&quot;').replace(/'/g, '&#039;');
                    
                    return `
                        <div class="item" onclick="downloadFileOnce('${safeName}', '${safeUrl}')">
                            <div class="item-preview">
                                <img src="${safeUrl}" 
                                     alt="${safeName}"
                                     loading="lazy"
                                     onerror="handleImageError(this)">
                            </div>
                            <div class="item-info">
                                <div class="item-name" title="${safeName}">${item.name}</div>
                                <div class="item-details">
                                    <div class="item-size">${formatFileSize(item.size)}</div>
                                    <div class="item-type">${getFileExtension(item.name)}</div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    // –û–±—ã—á–Ω—ã–π —Ñ–∞–π–ª
                    const safeName = item.name.replace(/'/g, "\\'");
                    const safeUrl = rawUrl.replace(/'/g, "\\'");
                    
                    return `
                        <div class="item" onclick="downloadFileOnce('${safeName}', '${safeUrl}')">
                            <div class="file-icon">üìÑ</div>
                            <div class="item-info">
                                <div class="item-name" title="${item.name}">${item.name}</div>
                                <div class="item-details">
                                    <div class="item-size">${formatFileSize(item.size)}</div>
                                    <div class="item-type">${getFileExtension(item.name)}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function handleImageError(imgElement) {
            imgElement.onerror = null;
            imgElement.parentElement.innerHTML = '<div class="file-icon">üìÑ</div>';
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–∞–ø–∫–∏
        function openFolder(folderName) {
            const newPath = currentPath ? `${currentPath}/${folderName}` : folderName;
            loadFolderContents(newPath);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∏—Å–∫–∞
        document.getElementById('search-input').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase().trim();
            
            // –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –ø—É—Å—Ç–æ–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
            if (query.length === 0) {
                document.getElementById('search-results').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                return;
            }
            
            // –ò—â–µ–º —Ç–æ–ª—å–∫–æ –≤ –∫—ç—à–µ Images
            const searchResults = allFilesCache.filter(item => 
                item.name.toLowerCase().includes(query)
            );
            
            if (searchResults.length === 0) {
                document.getElementById('main-content').style.display = 'none';
                document.getElementById('search-results').style.display = 'block';
                document.getElementById('search-results-title').textContent = `–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –¥–ª—è "${query}"`;
                document.getElementById('search-results-grid').innerHTML = '<div class="empty">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å</div>';
            } else {
                document.getElementById('main-content').style.display = 'none';
                document.getElementById('search-results').style.display = 'block';
                document.getElementById('search-results-title').textContent = `–ù–∞–π–¥–µ–Ω–æ: ${searchResults.length} —Ñ–∞–π–ª–æ–≤`;
                document.getElementById('search-results-grid').innerHTML = searchResults.map(item => createSearchResultElement(item)).join('');
            }
        });
        
        // –≠–ª–µ–º–µ–Ω—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞
        function createSearchResultElement(item) {
            const isFolder = item.type === 'dir';
            const isImage = !isFolder && isImageFile(item.name);
            const rawUrl = item.download_url || 
                          `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${item.path}`;
            
            // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
            const safeName = item.name.replace(/'/g, "\\'").replace(/"/g, '&quot;');
            const safeUrl = rawUrl.replace(/'/g, "\\'").replace(/"/g, '&quot;');
            
            if (isFolder) {
                // –î–ª—è –ø–∞–ø–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –æ—Ç START_PATH
                const folderPath = item.path.substring(START_PATH.length + 1);
                const folderName = folderPath.split('/')[0];
                
                return `
                    <div class="item folder" onclick="openFolder('${folderName.replace(/'/g, "\\'")}')">
                        <div class="folder-icon">üìÅ</div>
                        <div class="item-info">
                            <div class="item-name" title="${item.name}">${item.name}</div>
                            <div class="item-details">
                                <div class="item-type">–ü–∞–ø–∫–∞</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (isImage) {
                return `
                    <div class="item" onclick="downloadFileOnce('${safeName}', '${safeUrl}')">
                        <div class="item-preview">
                            <img src="${safeUrl}" 
                                 alt="${safeName}"
                                 loading="lazy"
                                 onerror="handleImageError(this)">
                        </div>
                        <div class="item-info">
                            <div class="item-name" title="${item.name}">${item.name}</div>
                            <div class="item-details">
                                <div class="item-size">${formatFileSize(item.size)}</div>
                                <div class="item-type">${getFileExtension(item.name)}</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                return `
                    <div class="item" onclick="downloadFileOnce('${safeName}', '${safeUrl}')">
                        <div class="file-icon">üìÑ</div>
                        <div class="item-info">
                            <div class="item-name" title="${item.name}">${item.name}</div>
                            <div class="item-details">
                                <div class="item-size">${formatFileSize(item.size)}</div>
                                <div class="item-type">${getFileExtension(item.name)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –û–î–ò–ù —Ä–∞–∑ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function downloadFileOnce(filename, url) {
            // –ï—Å–ª–∏ —É–∂–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
            if (isDownloading) {
                return;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            isDownloading = true;
            
            // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            const link = document.createElement('a');
            link.href = url;
            link.download = decodeURIComponent(filename);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ñ–ª–∞–≥–∞
            setTimeout(() => {
                isDownloading = false;
            }, 1000);
            
            // –ö–ª–∏–∫–∞–µ–º –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            link.style.display = 'none';
            document.body.appendChild(link);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º try-catch –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
            try {
                link.click();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:', error);
                // –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥
                window.open(url, '_blank');
            }
            
            // –£–¥–∞–ª—è–µ–º —Å—Å—ã–ª–∫—É
            setTimeout(() => {
                if (link.parentNode) {
                    document.body.removeChild(link);
                }
            }, 100);
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function isImageFile(filename) {
            const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg'];
            const ext = filename.split('.').pop().toLowerCase();
            return imageExtensions.includes(ext);
        }
        
        function getFileExtension(filename) {
            const ext = filename.split('.').pop().toUpperCase();
            return ext || '–§–ê–ô–õ';
        }
        
        function formatFileSize(bytes) {
            if (!bytes) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>